{% extends 'base.html' %}

{% block head %}
<title>Interests</title>
{% endblock %}

{% block body %}

<div class="container mt-5" style="max-width: 600px;">

  <!-- Back button -->
  <a href="#" onclick="history.back()" class="btn btn-outline-primary mb-3">
    ← Back
  </a>

  <!-- Card container -->
  <div class="card shadow-sm">
    <div class="card-body">

      <h3 class="mb-3 text-center">What are some of your interests?</h3>

      <form action="/interests" method="POST" onsubmit="return validateInterests()">

        <!-- Checkboxes -->
        <div class="mb-4">

          <div class="form-check mb-2">
            <input class="form-check-input" type="checkbox" name="interests[]" value="gardening" id="gardening">
            <label class="form-check-label" for="gardening">Gardening</label>
          </div>

          <div class="form-check mb-2">
            <input class="form-check-input" type="checkbox" name="interests[]" value="baking" id="baking">
            <label class="form-check-label" for="baking">Baking</label>
          </div>

          <div class="form-check mb-2">
            <input class="form-check-input" type="checkbox" name="interests[]" value="gaming" id="gaming">
            <label class="form-check-label" for="gaming">Gaming</label>
          </div>

          <div class="form-check mb-2">
            <input class="form-check-input" type="checkbox" name="interests[]" value="art and craft" id="art">
            <label class="form-check-label" for="art">Art and Craft</label>
          </div>

          <div class="form-check mb-2">
            <input class="form-check-input" type="checkbox" name="interests[]" value="watching shows" id="shows">
            <label class="form-check-label" for="shows">Watching Shows</label>
          </div>

          <div class="form-check">
            <input class="form-check-input" type="checkbox" name="interests[]" value="knitting" id="knitting">
            <label class="form-check-label" for="knitting">Knitting</label>
          </div>

        </div>

        <!-- Custom input -->
        <div class="mb-4">
          <label for="custom_interests" class="form-label fw-semibold">
            Add your own interests
          </label>

          <input
            type="text"
            id="custom_interests"
            name="custom_interests"
            class="form-control"
            placeholder="e.g. photography, cycling"
          >

          <div class="form-text">
            Separate multiple interests with commas.
          </div>
        </div>

        <!-- Submit -->
        <div class="d-grid">
          <button type="submit" class="btn btn-primary">
            Enter →
          </button>
        </div>

      </form>

    </div>
  </div>

</div>

{% endblock %}

<script>
function validateInterests() {

  const input = document.getElementById("custom_interests").value.trim();

  const hasChecked =
    document.querySelectorAll('input[name="interests[]"]:checked').length > 0;

  if (!hasChecked && !input) {
    alert("Please select at least one interest or add your own.");
    return false;
  }

  if (!input) return true;

  if (!input.includes(",") && input.split(/\s+/).length > 2) {
    alert("Please separate multiple interests with commas.");
    return false;
  }

  const interests = input
    .split(",")
    .map(i => i.trim())
    .filter(Boolean);

  const lowerInterests = interests.map(i => i.toLowerCase());

  if (new Set(lowerInterests).size !== interests.length) {
    alert("You have entered duplicate interests.");
    return false;
  }

  for (let i = 0; i < interests.length; i++) {

    const words = interests[i]
      .toLowerCase()
      .split(/\s+/);

    if (new Set(words).size !== words.length) {
      alert(`"${interests[i]}" contains repeated words.`);
      return false;
    }

  }

  return true;
}
</script>
