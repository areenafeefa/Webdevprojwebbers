{% extends 'base.html' %}

{% block head %}

<title>Interests</title>

{% endblock %}

{% block body %}
<a href="#" onclick="history.back()">← Back</a>

<h2>What are some of your interests?</h2>

<form action="/interests" METHOD = "POST" onsubmit="return validateInterests()">

    <!--checkboxes-->
  <div class="interest-group">
    <label><input type="checkbox" name="interests[]" value="gardening"> Gardening</label>
    <label><input type="checkbox" name="interests[]" value="baking"> Baking</label>
    <label><input type="checkbox" name="interests[]" value="gaming"> Gaming</label>
    <label><input type="checkbox" name="interests[]" value="art and craft"> Art and Craft</label>
    <label><input type="checkbox" name="interests[]" value="watching shows"> Watching Shows</label>
    <label><input type="checkbox" name="interests[]" value="knitting"> Knitting</label>
  </div>

  <div class="custom-input">
    <p><strong>Add your own below:</strong></p>
    <p>If you have more than one interest, separate them with commas.</p>
    <input
      type="text"
      id="custom_interests"
      name="custom_interests"
      placeholder="e.g. photography, cycling"
      style="width: 100%; padding: 8px;"
    >
  </div>

  <br>
  <button type="submit">Enter →</button>
</form>

{% endblock %}

  <!--javascript-->
<script>
function validateInterests() {
  // get the custom input text and remove extra spaces
  const input = document.getElementById("custom_interests").value.trim();

  // check if at least one checkbox is selected
  const hasChecked = document.querySelectorAll(
    'input[name="interests[]"]:checked'
  ).length > 0;

  // if nothing is selected AND no custom input is given
  if (!hasChecked && !input) {
    alert("Please select at least one interest or add your own.");
    return false;
  }

  if (!input) return true;

  // allow multi-word interests like "bird watching", only block long space-separated inputs
if (!input.includes(",") && input.split(/\s+/).length > 2) {
  alert("Please separate multiple interests with commas.");
  return false;
}

  // split custom input by commas
  const interests = input
    .split(",")
    .map(i => i.trim())
    .filter(Boolean); 

  // convert all interests to lowercase for fair comparison
  const lowerInterests = interests.map(i => i.toLowerCase());

  // check for duplicate interests
  if (new Set(lowerInterests).size !== interests.length) {
    alert("You have entered duplicate interests.");
    return false;
  }

  // check for repeated words inside one interest
  for (let i = 0; i < interests.length; i++) {
    const words = interests[i]
      .toLowerCase()
      .split(/\s+/);

    if (new Set(words).size !== words.length) {
      alert(`"${interests[i]}" contains repeated words.`);
      return false;
    }
  }
  return true;
}
</script>